{% extends "base.html" %}
{% block content %}

<section class="cp-page-head mb-3">
  <div>
    <h1 class="cp-title-sm mb-1"><i class="fa-solid fa-bookmark me-2"></i>Meus presentes reservados</h1>
    <div class="cp-subtitle small">Aqui você pode revisar e cancelar reservas.</div>
  </div>
  <div class="cp-page-actions">
    <a class="btn btn-outline-secondary" href="{% url 'catalogo' %}">
      <i class="fa-solid fa-arrow-left me-2"></i>Voltar ao catálogo
    </a>
  </div>
</section>

{% if reservations|length > 1 %}
  <div class="alert alert-warning">
    <div class="fw-semibold mb-1"><i class="fa-solid fa-triangle-exclamation me-2"></i>Você reservou {{ reservations|length }} presentes</div>
    <div class="small">
      Reservar mais de um presente pode impedir outra pessoa de escolher o presente que ela gostaria de dar.
      Se você reservou mais de um sem querer, cancele as reservas extras abaixo.
    </div>
  </div>
{% endif %}

{% if reservations %}
  <div class="row g-3 cp-card-grid">
    {% for r in reservations %}
      <div class="col-md-6 col-lg-4">
        <div class="card cp-card h-100 shadow-sm">
          {% if r.gift.image %}
            <img src="{{ r.gift.image.url }}" class="card-img-top cp-gift-img" alt="Imagem do presente">
          {% else %}
            <div class="cp-gift-placeholder d-flex align-items-center justify-content-center">
              <i class="fa-solid fa-image fa-2x text-muted"></i>
            </div>
          {% endif %}

          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h2 class="h6 mb-0">{{ r.gift.title }}</h2>
              <span class="badge text-bg-success"><i class="fa-solid fa-check me-1"></i>Reservado</span>
            </div>

            {% if r.gift.description %}
              <p class="text-muted small mb-3">{{ r.gift.description|linebreaksbr }}</p>
            {% endif %}

            {% if r.anonymous_message %}
              <div class="border rounded p-2 mb-3 bg-light">
                <div class="small fw-semibold mb-1"><i class="fa-regular fa-message me-1"></i>Sua mensagem anônima</div>
                <div class="small text-muted">{{ r.anonymous_message|linebreaksbr }}</div>
              </div>
            {% endif %}

            <div class="mt-auto">
              <form method="post" action="{% url 'cancelar_reserva' r.gift.id %}">
                {% csrf_token %}
                <button class="btn btn-outline-danger w-100" type="submit">
                  <i class="fa-solid fa-xmark me-2"></i>Cancelar reserva
                </button>
              </form>
            </div>

          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-secondary">
    Você ainda não reservou nenhum presente.
  </div>
{% endif %}

{% endblock %}
